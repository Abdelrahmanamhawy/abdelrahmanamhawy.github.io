<!DOCTYPE html>
<html>
<head>
    <title>WebView Cookie Test</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .log {
            background: #333;
            color: #0f0;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 5px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>WebView Cookie Extraction Test</h1>
    
    <div class="section">
        <h2>Configuration</h2>
        <label>Target URL:</label>
        <input type="text" id="targetUrl" value="https://node.ctftime/route-sharing/routeSharing/getOrder">
    </div>

    <div class="section">
        <h2>Tests</h2>
        <button onclick="testFetch()">Test Fetch API</button>
        <button onclick="testXHR()">Test XMLHttpRequest</button>
        <button onclick="testImage()">Test Image Load</button>
        <button onclick="testScript()">Test Script Load</button>
        <button onclick="testAll()">Run All Tests</button>
    </div>

    <div class="section">
        <h2>Results</h2>
        <div id="results">Click a test button to start...</div>
    </div>

    <div class="section">
        <h2>Logs</h2>
        <div class="log" id="logs"></div>
    </div>

    <script>
        let logText = '';
        
        function log(message) {
            const time = new Date().toLocaleTimeString();
            logText += '[' + time + '] ' + message + '\n';
            document.getElementById('logs').textContent = logText;
            console.log(message);
        }
        
        function showResult(test, success, details) {
            const resultsDiv = document.getElementById('results');
            const className = success ? 'success' : 'error';
            const status = success ? 'SUCCESS' : 'FAILED';
            
            resultsDiv.innerHTML += '<div class="' + className + '">' +
                '<h3>' + test + ': ' + status + '</h3>' +
                '<p>' + details + '</p>' +
                '</div>';
        }
        
        function getTargetUrl() {
            return document.getElementById('targetUrl').value;
        }
        
        async function testFetch() {
            log('Testing Fetch API...');
            const url = getTargetUrl() + '?test=fetch&t=' + Date.now();
            
            try {
                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'include',
                    mode: 'cors'
                });
                const endTime = Date.now();
                const timing = endTime - startTime;
                
                const text = await response.text();
                const details = 'Status: ' + response.status + ', Time: ' + timing + 'ms, Length: ' + text.length;
                
                log('Fetch result: ' + details);
                showResult('Fetch API', response.status === 200, details);
                
                if (response.status === 200) {
                    alert('FETCH SUCCESS! Status: 200, Response: ' + text.substring(0, 100));
                }
                
            } catch (error) {
                log('Fetch error: ' + error.message);
                showResult('Fetch API', false, 'Error: ' + error.message);
            }
        }
        
        function testXHR() {
            log('Testing XMLHttpRequest...');
            const url = getTargetUrl() + '?test=xhr&t=' + Date.now();
            
            const xhr = new XMLHttpRequest();
            const startTime = Date.now();
            
            xhr.withCredentials = true;
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    const timing = Date.now() - startTime;
                    const details = 'Status: ' + xhr.status + ', Time: ' + timing + 'ms, Length: ' + xhr.responseText.length;
                    
                    log('XHR result: ' + details);
                    showResult('XMLHttpRequest', xhr.status === 200, details);
                    
                    if (xhr.status === 200) {
                        alert('XHR SUCCESS! Status: 200, Response: ' + xhr.responseText.substring(0, 100));
                    }
                }
            };
            
            xhr.open('GET', url, true);
            xhr.send();
        }
        
        function testImage() {
            log('Testing Image load...');
            const url = getTargetUrl() + '?test=image&t=' + Date.now();
            
            const img = new Image();
            const startTime = Date.now();
            
            img.onload = function() {
                const timing = Date.now() - startTime;
                const details = 'Loaded successfully in ' + timing + 'ms, Size: ' + img.naturalWidth + 'x' + img.naturalHeight;
                
                log('Image result: ' + details);
                showResult('Image Load', true, details);
                alert('IMAGE SUCCESS! ' + details);
            };
            
            img.onerror = function() {
                const timing = Date.now() - startTime;
                const details = 'Failed to load in ' + timing + 'ms';
                
                log('Image error: ' + details);
                showResult('Image Load', false, details);
            };
            
            img.src = url;
        }
        
        function testScript() {
            log('Testing Script load...');
            const url = getTargetUrl() + '?test=script&t=' + Date.now();
            
            const script = document.createElement('script');
            const startTime = Date.now();
            
            script.onload = function() {
                const timing = Date.now() - startTime;
                const details = 'Script loaded in ' + timing + 'ms';
                
                log('Script result: ' + details);
                showResult('Script Load', true, details);
                alert('SCRIPT SUCCESS! ' + details);
                
                document.head.removeChild(script);
            };
            
            script.onerror = function() {
                const timing = Date.now() - startTime;
                const details = 'Script failed in ' + timing + 'ms';
                
                log('Script error: ' + details);
                showResult('Script Load', false, details);
                
                if (script.parentNode) {
                    document.head.removeChild(script);
                }
            };
            
            script.src = url;
            document.head.appendChild(script);
        }
        
        async function testAll() {
            document.getElementById('results').innerHTML = '<h3>Running all tests...</h3>';
            logText = '';
            
            log('Starting comprehensive test...');
            log('Target: ' + getTargetUrl());
            log('User Agent: ' + navigator.userAgent);
            log('Domain: ' + window.location.hostname);
            log('==========================================');
            
            await testFetch();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testXHR();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testImage();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testScript();
            
            log('==========================================');
            log('All tests completed!');
        }
        
        window.onload = function() {
            log('WebView Cookie Test loaded');
            log('Ready to test cross-domain cookie behavior');
        };
    </script>
</body>
</html>
